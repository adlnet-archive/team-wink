"use strict";var window,workerScript;try{window.ADL=window.ADL||{}}catch(e){window={ADL:{}}}try{workerScript=document.querySelector('script[src*="xapicollection"]').src}catch(e){}Array.isArray||(Array.isArray=function(n){return n.length>=0&&!n.length}),function(n){function i(n,t){var u,s,h,f,e,r,o;if(t===undefined)return null;if(n.length===0)return t;if(Array.isArray(n))u=n;else for(u=n.split("."),r=0;r<u.length;)u[r].slice(-1)==="\\"?u.splice(r,2,u[r].slice(0,-1)+"."+u[r+1]):r++;if(s=u[0],h=u.slice(1),s==="*"){if(f=[],e=[],Array.isArray(t))for(r=0;r<t.length;r++)e.push(r);else e=Object.keys(t);for(r=0;r<e.length;r++)o=i(h,t[e[r]]),Array.isArray(o)?f.push.apply(f,o):f.push(o);return f}return i(h,t[s])}function f(n,t,i){var r,u;if(Array.isArray(t))r=t;else for(r=t.split("."),u=0;u<r.length;)r[u].slice(-1)==="\\"?r.splice(u,2,r[u].slice(0,-1)+"."+r[u+1]):u++;return n||(n={}),n[r[0]]=r.length===1?i:n[r[0]]!==undefined?f(n[r[0]],r.slice(1),i):f({},r.slice(1),i),n}function t(n){Array.isArray(n)?this.contents=n.slice():n instanceof t?(this.contents=n.contents.slice(),this.parent=n):this.contents=[]}function r(n){if(this._callbacks={},!window.Worker)throw new Error("Your browser does not support WebWorkers, and cannot use the CollectionAsync class. Use CollectionSync instead.");this._worker=new Worker(workerScript);this._worker.onmessage=function(n){var t=r.deserialize(n.data);this._callbacks[t[0]]&&(this._callbacks[t[0]](t[1]),delete this._callbacks[t[0]])}.bind(this);var t=r.serialize(["push",n]);try{this._worker.postMessage(t,[t])}catch(i){this._worker.postMessage(t)}t.byteLength>0&&console.log("Warning: Your browser does not support WebWorker transfers. Performance of this site may suffer as a result.")}function u(n){return function(){var t=Array.prototype.slice.call(arguments);return this._worker.postMessage(r.serialize([n].concat(t))),this}}t.prototype.exec=function(n){return n(this.contents),this.parent};t.prototype.save=function(){return new t(this)};t.prototype.append=function(n){return this.contents=this.contents.concat(n),this};t.prototype.toCSV=function(){function r(n){return typeof n=="object"&&(n=JSON.stringify(n)),typeof n=="string"&&(n=n.replace(/"/g,'""')),'"'+n+'"'}var n,i,t;if(this.contents.length>0){for(n="",i=Object.keys(this.contents[0]),n+=i.map(r).join(",")+"\r\n",t=0;t<this.contents.length;t++)n+=i.map(function(n){return r(this.contents[t][n])}.bind(this)).join(",")+"\r\n";return n}return""};t.prototype.where=function(n){function e(n){function i(n){var t=/^\s*\((.*)\)\s*$/.exec(n);return t?i(t[1]):f(n)}function r(n){for(var i=0,t=0;t<n.length;t++)n[t]==="("?i++:n[t]===")"&&i--;return i===0}function f(n){for(var f,o,l,a,v,s=n.split(/\bor\b/),h="",c="",u=1;u<s.length;u++)if(f=s.slice(0,u).join("or"),o=s.slice(u).join("or"),f!=""&&r(f)&&o!=""&&r(o)){h=f;c=o;break}return h&&c?(l=i(h),a=i(c),l&&a?{or:[l,a]}:t):(v=e(n),v?v:t)}function e(n){for(var f,e,l,a,v,s=n.split(/\band\b/),h="",c="",u=1;u<s.length;u++)if(f=s.slice(0,u).join("and"),e=s.slice(u).join("and"),f!=""&&r(f)&&e!=""&&r(e)){h=f;c=e;break}return h&&c?(l=i(h),a=i(c),l&&a?{and:[l,a]}:t):(v=o(n),v?v:t)}function o(n){var u=/^\s*(.*?)\s*(!=|>=|<=|=|>|<)\s*(.*)\s*$/.exec(n),i,r;if(u)if(i=s(u[1]),r=h(u[3]),i){if(r instanceof RegExp)return u[2]==="="?{op:"re",xpath:i,value:r}:u[2]==="!="?{op:"nre",xpath:i,value:r}:(console.error("Regex comparison only supports = and !="),t);switch(u[2]){case"=":return{op:"eq",xpath:i,value:r};case"!=":return{op:"neq",xpath:i,value:r};case"<":return{op:"lt",xpath:i,value:r};case"<=":return{op:"leq",xpath:i,value:r};case">":return{op:"gt",xpath:i,value:r};case">=":return{op:"geq",xpath:i,value:r};default:return t}}else return t;else return t}function s(n){var i=/^\s*([^\.]+(?:\.[^\.]+)*)\s*$/.exec(n);return i?i[1]:t}function h(n){var i=null,r;return n=n.trim(),r=Number.isNaN||isNaN,/^0[0-7]+$/.test(n)&&!r(i=parseInt(n,8))?i:/^\d+$/.test(n)&&!r(i=parseInt(n,10))?i:/^0x[0-9a-f]+$/i.test(n)&&!r(i=parseInt(n,16))?i:r(i=parseFloat(n))?(i=/^\s*(["'])(.*)\1\s*$/.exec(n))?i[2]:(i=/^\s*\/(.*)\/(i?)\s*$/.exec(n))?new RegExp(i[1],i[2]):n==="null"?null:n==="true"||n==="false"?n==="true":t:i}var u=i(n);return u!=t?u:null}function r(n,t){var u,f,e;if(Array.isArray(n.and)&&n.and.length===0)return!0;if(Array.isArray(n.or)&&n.or.length===0)return!1;if(n.op&&!/\.\*\.?/.test(n.xpath))switch(n.op){case"eq":return i(n.xpath,t)===n.value;case"neq":return i(n.xpath,t)!==n.value;case"geq":return i(n.xpath,t)>=n.value;case"leq":return i(n.xpath,t)<=n.value;case"lt":return i(n.xpath,t)<n.value;case"gt":return i(n.xpath,t)>n.value;case"re":return n.value.test(i(n.xpath,t));case"nre":return!n.value.test(i(n.xpath,t));default:return!1}else{if(n.op&&/\.\*\.?/.test(n.xpath)){if(u=i(n.xpath,t),!u)return!1;for(f=0;f<u.length;f++)if(e=n.op==="eq"?u[f]===n.value:n.op==="neq"?u[f]!==n.value:n.op==="geq"?u[f]>=n.value:n.op==="leq"?u[f]<=n.value:n.op==="lt"?u[f]<n.value:n.op==="gt"?u[f]>n.value:n.op==="re"?n.value.test(u[f]):n.op==="nre"?!n.value.test(u[f]):!1,e)return!0;return!1}return n.and?r(n.and[0],t)?r({and:n.and.slice(1)},t):!1:n.or?r(n.or[0],t)?!0:r({or:n.or.slice(1)},t):!1}}var t=NaN,f,u;if(!n)return this;if(f=e(n),!f){console.error("Invalid where expression: "+n);return}for(u=0;u<this.contents.length;u++)r(f,this.contents[u])||this.contents.splice(u--,1);return this};t.prototype.math=function(n,r,u){var h,s,e,o,c;if(u&&u>0)for(o=this.contents,e=0;e<o.length;e++)h=new t(o[e].data),h.math(n,r,u-1),o[e].data=h.contents;else for(s=MathParser.parse(r),e=0;e<this.contents.length;e++){o=this.contents[e];for(c in s.xpaths)s.xpaths[c]=i(c,o);try{f(o,n,s.evaluate())}catch(l){console.log(l)}}return this};t.prototype.select=function(n,r){var l,s,e,c,o,a,u,v,h;if(r&&r>0)for(o=this.contents,u=0;u<o.length;u++)l=new t(o[u].data),l.select(n,r-1),o[u].data=l.contents;else{for(s=[],e=n.split(","),u=0;u<e.length;)e[u].slice(-1)==="\\"?e.splice(u,2,e[u].slice(0,-1)+","+e[u+1]):u++;for(u=0;u<e.length;u++)c=e[u].split(" as "),s.push({xpath:c[0].trim(),alias:c[1]?c[1].trim():null});for(o=this.contents,a=[],u=0;u<o.length;u++){for(v={},h=0;h<s.length;h++)f(v,s[h].alias||s[h].xpath,i(s[h].xpath,o[u]));a.push(v)}this.contents=a}return this};t.prototype.relate=function(n,r,u){var e=this.contents,s,f,o,h,c;if(u&&u>0)for(f=0;f<e.length;f++)s=new t(e[f].data),s.relate(n,r,u-1),e[f].data=s.contents;else for(f=0;f<e.length;f++)for(o=0;o<e[f].data.length;o++)h=i(n,e[f].data[o]),c=i(r,e[f].data[o]),e[f][h]=c;return this};t.prototype.slice=function(n,t){return t===null&&(t=undefined),this.contents=this.contents.slice(n,t),this};t.prototype.orderBy=function(n,t){var r=this.contents;return t=t==="descending"||t==="desc"?-1:1,r.sort(function(r,u){var f=i(n,r),e=i(n,u);return f!==null&&f!==undefined&&(f=f.toLowerCase()),e!==null&&e!==undefined&&(e=e.toLowerCase()),f!=null&&e==null?1*t:f==null&&e!=null?-1*t:f==e?0:(f<e?-1:1)*t}),this};t.prototype._groupByRange=function(n,t){var e,o,l,r,a,h;if(!(Array.isArray(t)&&t.length===3&&t[2]%1==0))return this.groupBy(n);var s=t[0],f=t[1],v=t[2],u,c;if(typeof s=="string"&&typeof f=="string"&&Date.parse(s)&&Date.parse(f)?(u=function(n){return Date.parse(n)},c=function(n,t){var i=new Date(Date.parse(n)+t);return i.toISOString()}):typeof s=="string"&&typeof f=="string"?(u=function(n){return n.charAt(0).toLowerCase().charCodeAt(0)-"a".charCodeAt(0)},c=function(n,t){return String.fromCharCode(n.charAt(0).toLowerCase().charCodeAt(0)+t)}):(u=function(n){return n},c=function(n,t){return n+t}),e=[],(u(f)-u(s))*v<=0)console.error("Group range is open, cannot generate groups!"),console.log(JSON.stringify(t)),e=[s,f];else{if(u(s)>u(f)){groupByRange(n,[f,s,-v]);dataStack.push(dataStack.pop().reverse());return}for(r=s;u(r)<u(f);r=c(r,v))e.push(r);e.push(f)}for(o=[],r=0;r<e.length-1;r++)o.push({group:e[r]+"-"+e[r+1],groupStart:e[r],groupEnd:e[r+1],data:[]});for(l=this.contents,r=0;r<l.length;r++)for(a=u(i(n,l[r])),h=0;h<o.length;h++)u(o[h].groupStart)<=a&&(a<u(o[h].groupEnd)||h==o.length-1&&a==u(o[h].groupEnd))&&o[h].data.push(l[r]);return this.contents=o,this};t.prototype.groupBy=function(n,r){var f,s,e,o,h,u;if(r)return this._groupByRange(n,r);if(f=this.contents,f[0]&&f[0].group&&f[0].data)for(u=0;u<f.length;u++)s=new t(f[u].data),s.groupBy(n),f[u].data=s.contents;else{for(e={},u=0;u<f.length;u++)if(o=i(n,f[u]),o)e[o]?e[o].push(f[u]):e[o]=[f[u]];else continue;h=[];for(u in e)h.push({group:u,data:e[u]});this.contents=h}return this};t.prototype.count=function(n){var i=this.contents,f,r,u,e;if(i[0]&&i[0].group&&i[0].data){if(n&&n>0){for(r=0;r<i.length;r++)i[r].data=new t(i[r].data).count(n-1).contents;return this}}else i=[{group:"all",data:i}];for(f=[],r=0;r<i.length;r++){u={};for(e in i[r])u[e]=i[r][e];u.count=u.data.length;u.sample=u.data[0];f.push(u)}return this.contents=f,this};t.prototype.sum=function(n,r){var u,s,f,h,o,e;if(!n)return this;if(u=this.contents,u[0]&&u[0].group&&u[0].data){if(r&&r>0){for(f=0;f<u.length;f++)u[f].data=new t(u[f].data).sum(n,r-1).contents;return this}}else u=[{group:"all",data:u}];for(s=[],f=0;f<u.length;f++){for(h=0,e=0;e<u[f].data.length;e++)h+=i(n,u[f].data[e]);o={};for(e in u[f])o[e]=u[f][e];o.sum=h;o.sample=o.data[0];s.push(o)}return this.contents=s,this};t.prototype.average=function(n,r){var u,s,f,h,e,o;if(!n)return this;if(u=this.contents,u[0]&&u[0].group&&u[0].data){if(r&&r>0){for(f=0;f<u.length;f++)u[f].data=new t(u[f].data).average(n,r-1).contents;return this}}else u=[{group:"all",data:u}];for(s=[],f=0;f<u.length;f++){for(h=0,o=0;o<u[f].data.length;o++)h+=i(n,u[f].data[o]);e={};for(o in u[f])e[o]=u[f][o];e.average=e.data.length>0?h/e.data.length:0;e.sample=e.data[0];s.push(e)}return this.contents=s,this};t.prototype.min=function(n,r){var u,h,f,s,o,e;if(!n)return this;if(u=this.contents,h=[],u[0]&&u[0].group&&u[0].data){if(r&&r>0){for(f=0;f<u.length;f++)u[f].data=new t(u[f].data).min(n,r-1).contents;return this}}else u=[{group:"all",data:u}];for(f=0;f<u.length;f++){for(s=Infinity,e=0;e<u[f].data.length;e++)s=Math.min(s,i(n,u[f].data[e]));o={};for(e in u[f])o[e]=u[f][e];o.min=s===Infinity?0:s;o.sample=o.data[0];h.push(o)}return this.contents=h,this};t.prototype.max=function(n,r){var u,h,f,s,o,e;if(!n)return this;if(u=this.contents,u[0]&&u[0].group&&u[0].data){if(r&&r>0){for(f=0;f<u.length;f++)u[f].data=new t(u[f].data).max(n,r-1).contents;return this}}else u=[{group:"all",data:u}];for(h=[],f=0;f<u.length;f++){for(s=-Infinity,e=0;e<u[f].data.length;e++)s=Math.max(s,i(n,u[f].data[e]));o={};for(e in u[f])o[e]=u[f][e];o.max=s===-Infinity?0:s;o.sample=o.data[0];h.push(o)}return this.contents=h,this};r.serialize=function(n){for(var i=JSON.stringify(n),r=new ArrayBuffer(2*i.length),u=new Uint16Array(r),t=0;t<i.length;t++)u[t]=i.charCodeAt(t);return r};r.deserialize=function(n){for(var i="",r=new Uint16Array(n),t=0;t<r.length;t+=1e3)i+=String.fromCharCode.apply(null,r.subarray(t,t+1e3));return JSON.parse(i)};r.prototype.exec=function(n){for(var t;this._callbacks[t=Math.floor(Math.random()*65536)];);return this._callbacks[t]=n,this._worker.postMessage(r.serialize(["exec",t])),this};r.prototype.append=function(n){var t=r.serialize(["append",n]);try{this._worker.postMessage(t,[t])}catch(i){this._worker.postMessage(t)}return this};r.prototype.save=u("save");r.prototype.where=u("where");r.prototype.math=u("math");r.prototype.select=u("select");r.prototype.relate=u("relate");r.prototype.slice=u("slice");r.prototype.orderBy=u("orderBy");r.prototype.groupBy=u("groupBy");r.prototype.count=u("count");r.prototype.sum=u("sum");r.prototype.average=u("average");r.prototype.min=u("min");r.prototype.max=u("max");n.CollectionSync=t;n.CollectionAsync=r;n.Collection=t}(window.ADL),function(n,t){var i=null;try{onmessage=function(r){var u=n.deserialize(r.data),f,e;u[0]==="exec"?(f=u[1],i?i=i.exec(function(t){var i=n.serialize([f,t]);try{postMessage(i,[i])}catch(r){postMessage(i)}}):postMessage(n.serialize([f,"error","nodata"]))):u[0]==="push"?(e=new t(u[1],i),i=e):i=i[u[0]].apply(i,u.slice(1))}}catch(r){if(r.message!=="onmessage is not defined")throw r;}}(window.ADL.CollectionAsync,window.ADL.CollectionSync);try{exports.CollectionSync=window.ADL.CollectionSync}catch(e){if(!/'?exports'? is (?:not |un)defined/.test(e.message))throw e;}
//# sourceMappingURL=xapicollection.min.js.map
